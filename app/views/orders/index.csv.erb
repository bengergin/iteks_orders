Order No,Company,Hit,Customer Name,Contract No,Season,Description,Pack Quantity,Pack,Size,Line Number,Country,Factory,Created,Placed On,Ex Factory Date,Customer Date,Customer Contract Month,Customer Contract Week,Add Ons,Gross Selling Price GBP,Gross Selling Price €,Gross Selling Price USD, Net Selling Price GBP, Net Selling Price €, Net Selling Price USD, Saved Exchange Rate,Pack Selling Price GBP (Converted),Buying Price Per Pack GBP,Buying Exchange Rate,Estimated Profit,Red Seal,Gold Seal,Testing,Packaging,Contract?,Quantity in Packs,Quantity in Dozen,Estimated Transport Cost,Buying Cost, Selling Cost
<%- @dispatches.each do |dispatch| -%>
<%- unless dispatch.order.customer.deleted -%>
<%- dispatch.dispatch_quantities.each do |dispatch_quantity| -%>
"<%= dispatch.order_reference %>","<%= dispatch.order.company.name %>","<%= dispatch.number %>","<%= dispatch.customer_name %>","<%= dispatch.customer_contract_number %>","<%= dispatch.order.season %>","<%= dispatch.order_description %>","<%= dispatch_quantity.order.quantity_per_pack %>","<%= dispatch_quantity.pack_size.pack.letter %>","<%= dispatch_quantity.pack_size.size.name %>","<%= dispatch_quantity.pack_size.line_number %>","<%= dispatch.country_name %>","<%= dispatch.factory_name %>","<%= dispatch.created_at.to_s(:day_month_year) %>","<%= dispatch.order.placed_on %>","<%= dispatch.ex_factory_date.to_s(:day_month_year) %>","<% if @current_user.contract_date? %><%= na dispatch.customer_contract_date.try(:strftime, "%d/%m/%y") %><% else %>N/A<% end %>","<%= dispatch.customer_contract_date.strftime("%B %Y") %>","<%= dispatch.customer_contract_date.strftime("%U") %>","<%= dispatch.has_add_ons ? "Yes" : "No" %>","<% if @current_user.selling_price? %><%= dispatch_quantity.pack_size.pack.gross_price_gbp %><% end %>","<% if @current_user.selling_price? %><%= dispatch_quantity.pack_size.pack.gross_price_eur %><% end %>","<% if @current_user.selling_price? %><%= dispatch_quantity.pack_size.pack.gross_price_usd %><% end %>","<% if @current_user.selling_price? %><%= dispatch_quantity.pack_size.pack.net_price_gbp %><% end %>","<% if @current_user.selling_price? %><%= dispatch_quantity.pack_size.pack.net_price_eur %><% end %>","<% if @current_user.selling_price? %><%= dispatch_quantity.pack_size.pack.net_price_usd %><% end %>","<% if @current_user.selling_price? %><%= dispatch_quantity.pack_size.pack.saved_exchange_rate %><% end %>",<%= dispatch_quantity.pack_size.pack.selling_cost_gbp %>,<% if @current_user.buying_price? %>"<%= dispatch_quantity.pack_size.pack.buying_price_per_pack_in_gbp %>","<%= dispatch_quantity.pack_size.pack.exchange_rate %>"<% end %>,<% if @current_user.buying_price? && @current_user.selling_price? %>"<%= dispatch_quantity.pack_size.pack.estimated_profit.round(2) unless !dispatch_quantity.pack_size.pack.estimated_profit %>%"<% end %>,"<%= dispatch.red_seal_approved_on %>","<%= dispatch.gold_seal_approved_on %>","<%= dispatch.testing_completed_on %>","<%= dispatch.packaging_approved_on %>","<%= dispatch.has_contract %>","<%= dispatch_quantity.quantity %>","<%= dispatch_quantity.quantity_in_dozens %>","<% if @current_user.selling_price? %><%= dispatch_quantity.estimated_transport_cost %><% end %>","<% if @current_user.buying_price? %><%= dispatch_quantity.buying_cost_gbp %><% end %>", <% if @current_user.selling_price? %><%= dispatch_quantity.net_selling_cost_gbp %><% end %>
<%- end -%>
<%- end -%>
<%- end -%>